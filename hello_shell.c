#include <stdio.h>
#include <windows.h> //for VirtualAlloc

char shellcode[] = "\xE8\x14\x00\x00\x00\x75\x73\x65\x72\x33\x32\x00\x48\x65"
"\x6C\x6C\x6F\x20\x57\x6F\x72\x6C\x64\x21\x00\x5D\xE8\x70\x00\x00\x00\x68\x8E"
"\x4E\x0E\xEC\x50\xE8\x1A\x00\x00\x00\x55\xFF\xD0\x68\xA8\xA2\x4D\xBC\x50\xE8"
"\x0C\x00\x00\x00\x31\xDB\x83\xC5\x07\x53\x55\x55\x53\xFF\xD0\xCC\x60\x8B\x6C"
"\xE4\x24\x8B\x45\x3C\x8B\x54\x28\x78\x01\xEA\x8B\x4A\x18\x8B\x5A\x20\x01\xEB"
"\xE3\x29\x49\x8B\x34\x8B\x01\xEE\x6A\x00\x56\xE8\x4D\x00\x00\x00\x3B\x44\xE4"
"\x28\x75\xEA\x8B\x5A\x24\x01\xEB\x66\x8B\x0C\x4B\x8B\x5A\x1C\x01\xEB\x8B\x04"
"\x8B\x01\xE8\xEB\x02\x31\xC0\x89\x44\xE4\x1C\x61\xC2\x08\x00\x56\x31\xC0\x64"
"\x8B\x40\x30\x8B\x40\x0C\x8B\x70\x1C\x8B\x46\x18\x6A\x01\x50\xE8\x10\x00\x00"
"\x00\x3D\x6F\x29\xC0\xF3\x74\x04\x8B\x36\xEB\xEA\x8B\x46\x08\x5E\xC3\x56\x57"
"\x53\x8B\x74\xE4\x10\x8B\x5C\xE4\x14\x31\xFF\xFC\x31\xC0\xAC\x01\xDE\x38\xE0"
"\x74\x07\xC1\xCF\x0D\x01\xC7\xEB\xF0\x89\xF8\x5B\x5F\x5E\xC2\x08\x00";

void launcher(void *shellcode_addr){
	int *ret;
	ret = (int *)&ret+2;
	*ret = (int)shellcode_addr;
	return;
}

int main(){
	void* executable_memory = VirtualAlloc(NULL, 4096,
	 MEM_RESERVE | MEM_COMMIT, PAGE_EXECUTE_READWRITE);
	if(executable_memory == 0){
		printf("VirtualAlloc Failed\n");
		return 0;
	}
	memcpy(executable_memory, shellcode, sizeof(shellcode));
	launcher(executable_memoery);
	printf("This line will never be printed\n");
}
